{% extends "base.html" %}
{% load static %}
{% block title %}üè† –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="mb-4">–ü—Ä–∏–≤—ñ—Ç, {{ user.first_name }}!</h2>
    <p class="text-muted">–í–∞—à–∞ —Ä–æ–ª—å: {{ user.get_role_display }}</p>

    <!-- –ê–∫—Ç—É–∞–ª—å–Ω—ñ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
            üó≥Ô∏è –ê–∫—Ç—É–∞–ª—å–Ω—ñ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è
        </div>
        <div class="card-body">
            {% if votes %}
                <div class="list-group">
                    {% for vote in votes %}
                        <a href="{% url 'vote_detail' vote.pk %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ vote.title }}</strong><br>
                                <small class="text-muted">–î–æ {{ vote.end_date|date:"d.m.Y H:i" }}</small>
                            </div>
                            {% if vote.id in voted_vote_ids %}
                                <span class="badge bg-success">–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–Ω–æ</span>
                            {% else %}
                                <span class="badge bg-warning text-dark">–©–µ –Ω–µ –≥–æ–ª–æ—Å—É–≤–∞–ª–∏</span>
                            {% endif %}
                        </a>
                    {% endfor %}
                </div>
                <div class="text-end mt-2">
                    <a href="{% url 'vote_list' %}" class="btn btn-outline-primary">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è</a>
                </div>
            {% else %}
                <p class="text-muted">–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –≥–æ–ª–æ—Å—É–≤–∞–Ω—å –¥–ª—è –≤–∞—Å.</p>
            {% endif %}
        </div>
    </div>

    <!-- –ê–∫—Ç—É–∞–ª—å–Ω—ñ –ø–µ—Ç–∏—Ü—ñ—ó -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-success text-white">
            üìã –ü–µ—Ç–∏—Ü—ñ—ó, —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –≥–æ–ª–æ—Å—ñ–≤
        </div>
        <div class="card-body">
            {% if petitions %}
                <div class="list-group">
                    {% for petition, percent in petitions %}
                        <a href="{% url 'petition_detail' petition.pk %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ petition.title }}</strong><br>
                                <small class="text-muted">–î–æ {{ petition.deadline|date:"d.m.Y H:i" }}</small>
                            </div>
                            <span class="badge bg-info text-dark">{{ percent|floatformat:0 }}% –ø—ñ–¥—Ç—Ä–∏–º–∫–∏</span>
                        </a>
                    {% endfor %}
                </div>
                <div class="text-end mt-2">
                    <a href="{% url 'petition_list' %}" class="btn btn-outline-success">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –ø–µ—Ç–∏—Ü—ñ—ó</a>
                </div>
            {% else %}
                <p class="text-muted">–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –ø–µ—Ç–∏—Ü—ñ–π, —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –≥–æ–ª–æ—Å—ñ–≤.</p>
            {% endif %}
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row g-4">
        <div class="col-md-6 col-xl-4">
            <div class="card text-white bg-info shadow">
                <div class="card-body">
                    <h5 class="card-title">üî¢ –ì–æ–ª–æ—Å—É–≤–∞–Ω—å –¥–æ—Å—Ç—É–ø–Ω–æ</h5>
                    <p class="card-text display-6">{{ votes|length }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-xl-4">
            <div class="card text-white bg-secondary shadow">
                <div class="card-body">
                    <h5 class="card-title">üìå –ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–Ω–æ</h5>
                    <p class="card-text display-6">{{ voted_vote_ids|length }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-xl-4">
            <div class="card text-white bg-success shadow">
                <div class="card-body">
                    <h5 class="card-title">üì£ –ê–∫—Ç–∏–≤–Ω–∏—Ö –ø–µ—Ç–∏—Ü—ñ–π</h5>
                    <p class="card-text display-6">{{ petitions|length }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
