<h5 class="mb-3">üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ:</h5>

<button class="btn btn-outline-success rounded-pill mb-4" data-bs-toggle="modal" data-bs-target="#commentModal">
    ‚ûï –î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä
</button>

{% include "petitions/partials/_comment_modal.html" %}

<p class="text-muted mb-3">–ó–∞–≥–∞–ª–æ–º –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤: <strong>{{ comments|length }}</strong></p>

{% if comments %}
    <div class="list-group">
        {% for comment in comments %}
            <div class="list-group-item mb-3 border rounded-4 p-3 bg-comment position-relative fade-in comment-card">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <strong>
                        {{ comment.author.get_full_name }}
                        <span class="text-muted">({{ comment.author.role }})</span>
                    </strong>
                    <small class="text-muted">
                        üìÖ {{ comment.created_at|date:"d E Y, H:i" }}
                    </small>
                </div>

                <p class="mb-2">{{ comment.text }}</p>

                <div class="d-flex justify-content-between align-items-end">
                    {% if comment.was_edited %}
                        <small class="text-muted fst-italic">
                            üìù –†–µ–¥–∞–≥–æ–≤–∞–Ω–æ: {{ comment.updated_at|date:"d E Y, H:i" }}
                        </small>
                    {% else %}
                        <span></span>
                    {% endif %}

                    {% if comment.author == request.user %}
                        <div class="d-flex gap-2 mt-1">
                            <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
                            <button class="btn btn-sm btn-outline-primary rounded-circle"
                                    title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏"
                                    data-bs-toggle="modal"
                                    data-bs-target="#editCommentModal-{{ comment.pk }}">
                                ‚úèÔ∏è
                            </button>

                            <!-- –ö–Ω–æ–ø–∫–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
                            <button type="button"
                                    class="btn btn-sm btn-outline-danger rounded-circle"
                                    title="–í–∏–¥–∞–ª–∏—Ç–∏"
                                    data-bs-toggle="modal"
                                    data-bs-target="#deleteCommentModal-{{ comment.pk }}">
                                üóëÔ∏è
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Modal: –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è -->
            <div class="modal fade" id="editCommentModal-{{ comment.pk }}" tabindex="-1"
                 aria-labelledby="editCommentModalLabel-{{ comment.pk }}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow">
                        <form method="post" action="{% url 'edit_comment' petition.pk comment.pk %}">
                            {% csrf_token %}
                            <div class="modal-header">
                                <h5 class="modal-title" id="editCommentModalLabel-{{ comment.pk }}">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä–∏—Ç–∏"></button>
                            </div>
                            <div class="modal-body">
                                <textarea name="text" class="form-control" rows="4" required>{{ comment.text }}</textarea>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                                <button type="submit" class="btn btn-primary rounded-pill">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
                            </div>  
                        </form>
                    </div>
                </div>
            </div>

            <!-- Modal: –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è -->
            <div class="modal fade" id="deleteCommentModal-{{ comment.pk }}" tabindex="-1"
                 aria-labelledby="deleteCommentModalLabel-{{ comment.pk }}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow">
                        <form method="post" action="{% url 'delete_comment' petition.pk comment.pk %}">
                            {% csrf_token %}
                            <div class="modal-header bg-danger text-white rounded-top-4">
                                <h5 class="modal-title" id="deleteCommentModalLabel-{{ comment.pk }}">‚ùó –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä–∏—Ç–∏"></button>
                            </div>
                            <div class="modal-body">
                                <p class="mb-0">–í–∏ —Å–ø—Ä–∞–≤–¥—ñ —Ö–æ—á–µ—Ç–µ <strong>–≤–∏–¥–∞–ª–∏—Ç–∏</strong> —Ü–µ–π –∫–æ–º–µ–Ω—Ç–∞—Ä?</p>
                                <p class="text-muted small mt-2">–¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                                <button type="submit" class="btn btn-danger rounded-pill">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        {% endfor %}
    </div>
{% else %}
    <p class="text-muted">–ù–µ–º–∞—î –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤. –°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä—à–∏–º!</p>
{% endif %}

<style>
/* üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞ –¥–ª—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ */
.comment-card {
    transition: background-color 0.3s ease, color 0.3s ease;
    background-color: rgba(255, 255, 255, 0.95);
}
body.dark-mode .comment-card {
    background-color: #2c2c2c;
    color: #f1f1f1;
}
body.dark-mode .comment-card .text-muted {
    color: #bbb !important;
}
body.dark-mode .comment-card .btn-outline-primary,
body.dark-mode .comment-card .btn-outline-danger {
    border-color: #555;
    color: #f8f9fa;
}
body.dark-mode .comment-card .btn-outline-primary:hover,
body.dark-mode .comment-card .btn-outline-danger:hover {
    background-color: #0d6efd;
    color: #fff;
}

/* üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω */
body.dark-mode .modal-content {
    background-color: #2c2c2c;
    color: #f1f1f1;
}
body.dark-mode .modal-header,
body.dark-mode .modal-footer {
    border-color: #444;
}
body.dark-mode .modal-header .btn-close {
    filter: invert(1);
}
body.dark-mode .modal-body textarea,
body.dark-mode .modal-body .form-control {
    background-color: #3a3a3a;
    color: #f1f1f1;
    border: 1px solid #555;
}
body.dark-mode .modal-body textarea::placeholder {
    color: #aaa;
}
body.dark-mode .btn-secondary {
    background-color: #444;
    border-color: #666;
}
body.dark-mode .btn-secondary:hover {
    background-color: #555;
}
body.dark-mode .btn-primary {
    background-color: #0d6efd;
    border-color: #0d6efd;
}
body.dark-mode .btn-danger {
    background-color: #dc3545;
    border-color: #dc3545;
}
</style>
