{% extends "base.html" %}

{% block title %}Створити голосування{% endblock %}

{% block content %}
<h2>Створити нове голосування</h2>

<form method="post" id="vote-form">
    {% csrf_token %}
    {{ vote_form.as_p }}

    <h4>Варіанти відповіді</h4>
    <div id="formset-container">
        {{ formset.management_form }}
        {% for form in formset %}
            <div class="card p-2 mb-2 formset-form">
                <div class="mb-2">
                    {{ form.text.label }}: {{ form.text }}
                </div>
                <div>
                    {{ form.is_correct }} {{ form.is_correct.label }}
                </div>
            </div>
        {% endfor %}
    </div>

    <button type="button" class="btn btn-secondary mb-3" id="add-option">+ Додати варіант</button>
    <br>
    <button type="submit" class="btn btn-success">Створити</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const container = document.getElementById("formset-container");
    const addBtn = document.getElementById("add-option");
    const totalForms = document.getElementById("id_form-TOTAL_FORMS");

    addBtn.addEventListener("click", function () {
        const currentCount = parseInt(totalForms.value);
        const firstForm = document.querySelector(".formset-form");
        const newForm = firstForm.cloneNode(true);

        // Очистити значення у новій формі
        newForm.querySelectorAll("input").forEach(function (input) {
            if (input.type === "checkbox") {
                input.checked = false;
            } else {
                input.value = "";
            }

            const name = input.name.replace(/form-\d+-/, `form-${currentCount}-`);
            const id = input.id.replace(/form-\d+-/, `form-${currentCount}-`);
            input.name = name;
            input.id = id;
        });

        // Також оновити label "for"
        newForm.querySelectorAll("label").forEach(function (label) {
            const newFor = label.getAttribute("for")?.replace(/form-\d+-/, `form-${currentCount}-`);
            if (newFor) label.setAttribute("for", newFor);
        });

        container.appendChild(newForm);
        totalForms.value = currentCount + 1;
    });
});
</script>
{% endblock %}
