{% extends "base.html" %}

{% block title %}{{ vote.title }}{% endblock %}

{% block content %}
<h2>{{ vote.title }}</h2>
<p>{{ vote.description }}</p>
{% if request.user == vote.creator %}
    <p class="mb-1"><strong>Author:</strong> {{ vote.creator.get_full_name }} <span class="badge bg-secondary">You</span></p>
    
{% else %}
    <p class="mb-1"><strong>Author:</strong> {{ vote.creator.get_full_name }}</p>
{% endif %}

{% if vote.end_date %}
    <p><strong>–î–æ—Å—Ç—É–ø–Ω–µ –¥–æ:</strong> {{ vote.end_date|date:"SHORT_DATETIME_FORMAT" }}</p>
{% endif %}
<p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ vote.get_status_display }}</p>

<hr>

<h4>–í–∞—Ä—ñ–∞–Ω—Ç–∏:</h4>
<ul class="list-group mb-3">
    {% for option in options %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ option.text }}
            <span class="badge bg-primary rounded-pill">{{ option.vote_count }}</span>
        </li>
    {% endfor %}
</ul>

{% if can_vote %}
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-success">–ü—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞—Ç–∏</button>
    </form>
{% elif already_voted %}
    <div class="alert alert-info">–í–∏ –≤–∂–µ –ø—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞–ª–∏ —É —Ü—å–æ–º—É –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—ñ.</div>
{% else %}
    <div class="alert alert-warning">–ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è —â–µ –Ω–µ –ø–æ—á–∞–ª–æ—Å—è –∞–±–æ –≤–∂–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å.</div>
{% endif %}

<h5 class="mt-4">–•—Ç–æ –º–æ–∂–µ –≥–æ–ª–æ—Å—É–≤–∞—Ç–∏:</h5>
<ul>
    {% for user in eligible_users %}
        <li>{{ user.get_full_name }} ({{ user.role }})</li>
    {% empty %}
        <li>–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤</li>
    {% endfor %}
</ul>


{% if request.user == vote.creator or request.user.role in "director admin" %}
    <form method="post" action="{% url 'vote_delete' vote.pk %}" onsubmit="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è?');">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger mt-3">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è</button>
    </form>
{% endif %}


<a href="{% url 'vote_list' %}" class="btn btn-secondary mt-3">‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É</a>
{% endblock %}
